# AHC060 解法戦略

## 概要
本実装は、複数の初期解を生成して最良のものを選択する**多解探索型の貪欲法**を採用しています。

## 主要な戦略

### 1. 複数初期解生成（1.8秒以内）
- **目的**: ランダム性を含む貪欲法のため、複数回試行して最良解を選択
- **実装**: 1.8秒の時間制限内で可能な限り多くの初期解を生成し、スコアが最も高いものを選ぶ
- **効果**: 単一の初期解では得られない高いスコア（700点台）を実現

### 2. 事前計算：各ショップから到達可能な木の探索
- **方法**: BFS（幅優先探索）で各ショップから到達可能なすべての木を事前に計算
- **用途**: コーンが空の場合の木選択戦略に活用
  - より多くのショップから到達可能な木を優先
  - その木に到達可能なショップのうち、まだ未納品の組み合わせが多いショップの数をスコアとして評価
  - スコアが高い木を優先選択（同じスコアの場合はランダム）
- **効果**: より効率的なルート選択により、スコア向上が期待できる

### 3. 移動戦略（優先順位付き）

#### 3.1 新たな組み合わせが作れない場合のFlip操作
- **条件**: 
  - コーンにアイスが入っている
  - 現在位置が木（k以上）
  - そのアイスの組み合わせが**すべてのショップ**に既に納品済み
  - 現在の木がバニラ（'W'）である
- **動作**: Flip操作（-1）を実行して木をストロベリー（'R'）に変更
- **目的**: 新しい組み合わせを作る可能性を高める

#### 3.2 コーンがある場合のショップ選択
- **優先**: コーンの内容が**まだ納品されていない**ショップを優先
- **理由**: 重複納品を避けて、多様な組み合わせを各ショップに納品する

#### 3.3 コーンが空の場合の木選択
- **優先**: 木（k以上）を優先して移動
- **理由**: アイスを収穫してコーンに追加するため

#### 3.4 ランダム選択
- **方法**: 候補の中からランダムに選択（`rng.gen_range`）
- **目的**: 探索の多様性を確保し、異なる解を生成

### 4. 制約の遵守
- **前回の位置への戻り禁止**: 直前の位置には戻れない
- **隣接頂点のみ移動**: グラフの辺で接続されている頂点のみ移動可能
- **操作数の上限**: t回まで操作可能

### 5. スコア計算
- **評価関数**: 各ショップに納品された**ユニークなアイスの組み合わせの数**の合計
- **データ構造**: `BTreeSet<Vec<char>>`で各ショップの在庫を管理し、重複を自動的に排除

## アルゴリズムの流れ

```
1. 入力の読み込みとグラフ構築
2. 各ショップから到達可能な木をBFSで事前計算
3. 1.8秒間、以下を繰り返し:
   a. 初期状態にリセット
   b. t回まで操作を繰り返し:
      - 移動候補を決定（戦略3に基づく）
      - ランダムに選択して移動
      - ショップなら納品、木なら収穫
   c. スコアを評価
   d. 最良解を更新
4. 最良解を出力
```

## 改善の余地

- **山登り法**: 現在はコメントアウトされているが、初期解に対して局所探索を適用することでさらなる改善が期待できる
- **より高度な貪欲選択**: 現在はランダム選択だが、より良い評価関数に基づいた選択も検討可能
- **時間配分の最適化**: 初期解生成と改善の時間配分を調整

## 現在の性能

- **初期解スコア**: 約700点（seed=1の場合）
- **実行時間**: 約1.8秒（初期解生成のみ）
- **特徴**: シンプルで高速、ランダム性により多様な解を探索
